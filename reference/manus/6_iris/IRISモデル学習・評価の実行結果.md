# IRISモデル学習・評価の実行結果

## 実装概要

IRISモデルの学習と評価のために、SpCaの実装を参考にした2つのスクリプトを作成しました：

1. **iris_train.py**: IRISモデルの学習スクリプト
   - 画像検索に最適化された3つのモジュール（ORACLE、CASTLE、NEXUS）を統合
   - 分散学習対応
   - TensorBoard連携によるメトリクス可視化
   - チェックポイント保存と復元機能

2. **iris_evaluate.py**: IRISモデルの評価スクリプト
   - mAP (Mean Average Precision) の計算
   - Precision@K の計算
   - 難易度別評価（Easy/Medium/Hard）対応
   - 結果の可視化と保存機能

## 学習・評価の実行方法

### 学習の実行

```bash
python iris_train.py --model iris --backbone resnet18 --batch_size 64 --num_epochs 100
```

主なオプション:
- `--model`: モデル名（デフォルト: iris）
- `--backbone`: バックボーンネットワーク（resnet18/resnet50）
- `--batch_size`: バッチサイズ
- `--num_epochs`: 学習エポック数
- `--resume`: チェックポイントからの復元パス

### 評価の実行

```bash
python iris_evaluate.py --model_path ./checkpoints/iris-bbresnet18-dim512/best_checkpoint.pth --datasets roxford5k rparis6k
```

主なオプション:
- `--model_path`: 評価するモデルのパス
- `--datasets`: 評価するデータセット（複数指定可）
- `--output_dir`: 結果の保存ディレクトリ

## 実データでの利用に向けて

現在の実装では、データセットのロード部分にプレースホルダーを使用しています。実際のデータセットで学習・評価を行うには、以下の修正が必要です：

1. **データセットの準備**:
   - GLDv2_lmdbクラスを実際のデータセットに合わせて実装
   - 画像の前処理パイプラインの調整

2. **評価データセットの準備**:
   - roxford5k、rparis6kなどの評価データセットの読み込み実装
   - 正解データ（ground truth）の形式を合わせる

3. **ハイパーパラメータの調整**:
   - バッチサイズ、学習率、エポック数などの調整
   - IRISモジュール固有のパラメータ（oracle_num_objects、castle_num_heads、nexus_sparsityなど）の最適化

## 期待される性能

IRISモデルは、画像検索に最も効果的なモジュールのみを統合しているため、以下の点で優れた性能が期待できます：

1. **検索精度**: 
   - ORACLE: オブジェクトレベルの理解と関係性認識により、部分的な一致や構成要素の類似性に基づく検索が可能
   - CASTLE: バッチ内の画像間の関係性を考慮し、ノイズや外れ値に対する堅牢性を向上

2. **効率性**:
   - NEXUS: スパース注意機構により計算効率が向上し、大規模ギャラリーに対する高速検索が可能
   - 不要なモジュール（PRISM、HARMONY）を除外することで、計算リソースを効率的に活用

3. **汎用性**:
   - 異なるバックボーンネットワーク（ResNet18/ResNet50）に対応
   - 様々なドメインのデータセットに適用可能

## 今後の展望

1. **モデルの改良**:
   - 各モジュールのハイパーパラメータの最適化
   - 新しい注意機構やバックボーンネットワークの統合

2. **評価の拡張**:
   - より多様なデータセットでの評価
   - 計算効率と精度のトレードオフ分析

3. **実用化**:
   - 大規模データセットでの分散学習
   - モバイルデバイスなどのリソース制約環境への最適化
